"use strict";function round(a,b){if(a=parseFloat(a),isNaN(a))return a;b||(b=0);var c=Math.pow(10,b);return Math.floor(a*c+(a*c*10%10>=5?1:0))/c}var resizeCanvasFont=function(){var a=$(window).height()-40,b=$(window).width()-80,c=a/3,d=b/5,e=Math.min(Math.max(5,Math.min(c,d)/20),15);$("html").css("font-size",e+"px"),console.log("resizeCanvasFont size=",e)};$(document).ready(function(){$(window).resize(resizeCanvasFont),resizeCanvasFont(),window.navigator.standalone});var FirstRevenueApp=angular.module("FirstRevenueApp",["ngResource","bootstrap","$strap.directives","firebase"]).config(["$routeProvider",function(a){a.when("/impress/:modelId",{templateUrl:"views/impress/Impress.html",controller:"ImpressController"}).when("/",{templateUrl:"views/impress/Impress.html",controller:"ImpressController"}).otherwise({redirectTo:"/"})}]).run(["$route",function(a){a.reload()}]);FirstRevenueApp.controller("CanvasController",["$scope","$route","$location","$window","_","Modal","Zoom","Rainbow",function(a,b,c,d,e,f,g,h){var i="CanvasController";console.log(i,"route invoked $route=",b);var j=b.current.params.modelId,k={KP:{iconId:106,initials:"KP",name:"Key Partnerships"},KA:{iconId:51,initials:"KA",name:"Key Activities"},KR:{iconId:82,initials:"KR",name:"Key Resources"},VP:{iconId:89,initials:"VP",name:"Value Propositions"},CR:{iconId:83,initials:"CR",name:"Customer Relationships"},CH:{iconId:261,initials:"CH",name:"Channels"},CS:{iconId:175,initials:"CS",name:"Customer Segments"},CX:{iconId:165,initials:"C$",name:"Cost Structure"},RX:{iconId:200,initials:"R$",name:"Revenue Streams"}},l=[!0,"edit","full"],m=["full"];angular.extend(a,{modal:f,zoom:g,rainbow:h,blocks:null,stickers:null,getBlocks:function(){return k},getStickers:function(b){var c={},d=a.canvas.modelId,e=a.me.sync.models[d];return e&&e.stickers&&angular.forEach(a.me.sync.models[d].stickers,function(a,d){a.block===b&&(c[d]=a)}),c},getSticker:function(b){return a.me.sync.models[j].stickers[b]},isPublicModel:function(){return a.sync.public&&a.sync.public.models&&!!a.sync.public.models[j]},getCanvasURL:function(){var b=d.location.origin||d.location.protocol+"//"+d.location.host,c=b+d.location.pathname,e=c+"#/canvas/"+a.canvas.modelId;return e},getModelPermission:function(){return a.sync.user.models?a.sync.user.models[j]:null},isMyModel:function(){return!!a.getModelPermission()},isModelEditable:function(){return e.contains(l,a.getModelPermission())},isModelFullAccess:function(){return e.contains(m,a.getModelPermission())}}),a.layout.tooltips=!0,a.layout.setView("canvas"),a.layout.guide.wide=!1,a.layout.peer.wide=!1,a.layout.qrCode=!1,a.canvas.setModel(j,a.me.sync.models[j])}]),FirstRevenueApp.controller("ImpressController",["$scope","$route",function(a,b){var c="ImpressController";console.log(c,"invoked");var d={KP:{iconId:106,initials:"KP",name:"Key Partnerships"},KA:{iconId:51,initials:"KA",name:"Key Activities"},KR:{iconId:82,initials:"KR",name:"Key Resources"},VP:{iconId:89,initials:"VP",name:"Value Propositions"},CR:{iconId:83,initials:"CR",name:"Customer Relationships"},CH:{iconId:261,initials:"CH",name:"Channels"},CS:{iconId:175,initials:"CS",name:"Customer Segments"},CX:{iconId:165,initials:"C$",name:"Cost Structure"},RX:{iconId:200,initials:"R$",name:"Revenue Streams"}};angular.extend(a,{modelId:null,getBlocks:function(){return d},getStickers:function(b){var c={},d=a.im.model;return d&&d.stickers&&angular.forEach(a.im.model.stickers,function(a,d){a.block===b&&(c[d]=a)}),c}}),a.modelId=b.current.params.modelId,console.log(c,"$route=",b,"modelId=",a.modelId),a.modelId&&a.im.loadModel(a.modelId)}]),FirstRevenueApp.controller("ImpressMasterController",["$scope","$route","$routeParams","$window","Canvas","ImpressModel",function(a,b,c,d,e,f){var g="ImpressMasterController";console.log(g,"launched"),angular.extend(a,{canvas:e,im:f}),a.rootRef=new Firebase(CONFIG_1ST_REVENUE.firebaseEndpoint),d.document.title=a.appName+" Presentation",f.init(a.rootRef,a),console.log(g,"$route=",b,"modelId=",a.modelId,"$routeParams=",c),analytics.track("Impress launch")}]),FirstRevenueApp.factory("Canvas",["_","Menu","BMG",function(a,b,c){var d="Canvas";console.log(d,"service launched");var e={bmg:c,view:"free",loaded:!1,modelId:0,lastModelId:0,model:null,singleBlock:null,showBlockInitials:!1,reset:function(){this.loaded=!1,this.model=null,this.singleBlock=null},setModel:function(a,c){e.modelId=a,e.model=c||null,b.selected="canvas",b.setTitle(c&&c.fields?c.fields.name:null)},setView:function(a){e.view=a},toggleView:function(){e.view="free"===e.view?"grid":"free"},peerCount:function(){return e.model?a.size(e.model.users):0},getStyle:function(){return"st-list-style4"},getLogoStyle:function(){var a=$(".model-logotype"),b=-Math.round(a.width()/2),c=-Math.round(a.height()/2);return{"margin-left":b,"margin-top":c}},getGridClass:function(){return"grid"===this.view?"pane-grid":"list"===this.view?"pane-list":""},getAbs:function(a){return"free"===e.view&&a&&angular.isNumber(a.x)&&angular.isNumber(a.y)||!1},getPosition:function(a){return e.getAbs(a)?"left: "+a.x+"%; top: "+a.y+"%;":""},switchBlock:function(b){console.log(d,"switchBlock pane=",b,"this.model.blocks=",e.model.blocks),e.singleBlock=a.find(e.model.blocks,function(a){return console.log(d,"switchBlock findingBlock b=",a),a.paneClass===b.icon})},getBackgroundImageURL:function(){return"images/DemoCanvasModelIcon.png"}};return e}]),FirstRevenueApp.factory("ImpressModel",["$timeout","$window","Canvas","angularFire",function(a,b,c,d){var e="ImpressModel";console.log(e,"service launched");var f={rootRef:null,masterScope:null,dereg:{},init:function(a,b){console.log(e,"init"),f.rootRef=a,f.masterScope=b},angularFire:function(a,b,c){console.log(e,"angularFire name=",b,c),c=angular.isUndefined(c)?{}:c;var g=d(a,f.masterScope,b,c);return g.then(function(a){console.log(e,"angularFire callback afReady=",a),a.off&&a.name?f.dereg=a.off:g.off&&(f.dereg=g.off)}),g},loadModel:function(a){console.log(e,"loadModel modelId=",a);var b=f.rootRef.child("models").child(a),c=f.angularFire(b,"canvas.model");c?c.then(f.loadModelData):console.log(e,"loadModel angularFire failed for modelId",a)},loadModelData:function(d){console.log(e,"loadModelData modelPromise resolved modelReady=",d),a(function(){b.document.title=c.model.fields.name+" - 1st Revenue Presentation",impress().init()})}};return f}]);